;
; Cookbook Name:: logging_rsyslog
;
; Copyright RightScale, Inc. All rights reserved.  All access and use subject to the
; RightScale Terms of Service available at http://www.rightscale.com/terms.php and,
; if applicable, other agreements such as a RightScale Master Subscription Agreement.
;
; Managed by RightScale
; DO NOT EDIT BY HAND
;

cert = <%= @certificate %>
<%= @client  %>

; Protocol version (all, SSLv2, SSLv3, TLSv1)
<% unless @client %>
sslVersion = SSLv3
<%# Setting up the verification level depending on whether we use a certificate %>
<%# provided by the user or a self-signed one. %>
<% @level = node[:logging][:certificate].nil? ? "1" : "3" %>
verify = <%= @level %>
  <% if @level == "3" %>
  <%# verify = 3 would require and verify certificates against locally installed certificates. %>
CAfile = <%= @certificate %>
  <% end %>
<% else %>
<%# Force SSLv3+ for clients. %>
options = NO_SSLv2
<% end %>

chroot = <%= @chroot %>
setuid = <%= @owner %>
setgid = <%= @group %>
pid =  <%= @pid %>

; Some performance tunings
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
;compression = zlib

; Some debugging stuff useful for troubleshooting
debug = 7
output = /var/log/stunnel

; Service-level configuration
[syslog]
accept  = <%= @accept %>
connect = <%= @connect %>
